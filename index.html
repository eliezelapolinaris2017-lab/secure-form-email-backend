<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Puerto Rico Dresses — Formulario</title>

  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:#f6f7fb;
      color:#111827;
    }
    .wrap{max-width:560px;margin:28px auto;padding:16px}
    .card{
      background:#fff;
      border-radius:12px;
      padding:20px;
      box-shadow:0 10px 28px rgba(0,0,0,.08);
    }
    .brand{
      text-align:center;
      margin-bottom:10px;
    }
    .brand h1{
      margin:0;
      font-size:20px;
      letter-spacing:.2px;
      font-weight:900;
    }
    .brand p{
      margin:6px 0 0;
      font-size:13px;
      color:#6b7280;
    }
    label{display:block;margin-top:14px;font-weight:700;font-size:13px}
    input,textarea{
      width:100%;
      margin-top:6px;
      padding:10px 12px;
      border:1px solid #d1d5db;
      border-radius:10px;
      font-size:14px;
      box-sizing:border-box;
    }
    textarea{min-height:90px;resize:vertical}
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .grid .full{grid-column:1 / -1}
    button{
      margin-top:16px;
      width:100%;
      padding:12px;
      background:#2563eb;
      color:#fff;
      border:none;
      border-radius:10px;
      font-weight:800;
      cursor:pointer;
    }
    button:disabled{opacity:.6}
    .msg{margin-top:10px;font-size:13px}
    .ok{color:#0a7b34;font-weight:800}
    .err{color:#b42318;font-weight:800}
    .legal{margin-top:14px;font-size:11.5px;color:#6b7280;text-align:center}
    .hint{
      margin-top:8px;
      padding:10px 12px;
      border-radius:10px;
      background:#f3f4f6;
      color:#374151;
      font-size:12.5px;
      line-height:1.35;
    }
  </style>

  <!-- CONFIG -->
  <script>
    const SITE_KEY = "6LdB4jAsAAAAALaPzH7IBial1E3b5I4PG77-P15n";
    const BACKEND_URL = "https://secure-form-email-backend.onrender.com";
  </script>

  <!-- Google reCAPTCHA v3 -->
  <script src="https://www.google.com/recaptcha/api.js?render=6LdB4jAsAAAAALaPzH7IBial1E3b5I4PG77-P15n"></script>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="brand">
        <h1>Puerto Rico Dresses</h1>
        <p>Complete el formulario. Recibiremos su solicitud por email.</p>
      </div>

      <form id="form">
        <label>Nombre *</label>
        <input name="name" required autocomplete="name">

        <label>Email *</label>
        <input name="email" type="email" required autocomplete="email">

        <label>Teléfono *</label>
        <input name="phone" required autocomplete="tel">

        <label>¿Qué tipo de servicio desea? *</label>
        <input name="service" required placeholder="Ej: Vestidos, alquiler, consulta, etc.">

        <div class="hint">
          <strong>Importante:</strong> Esta información NO se enviará como texto “mezclado”.
          Se enviará en líneas separadas, limpio y en orden.
        </div>

        <label>¿Dónde será su actividad? (Opcional)</label>
        <textarea name="actividad" placeholder="Ej: Hotel, salón, residencia, etc."></textarea>

        <div class="grid">
          <div class="full">
            <label>Ciudad del Evento (Opcional)</label>
            <input name="ciudad" placeholder="Ej: San Juan">
          </div>

          <div>
            <label>Día de su evento (Opcional)</label>
            <input name="dia" type="date">
          </div>

          <div>
            <label>Hora del Evento (Opcional)</label>
            <input name="hora" type="time">
          </div>

          <div class="full">
            <label>¿Tienes coordinador de eventos? ¿Cuál es su nombre? (Opcional)</label>
            <input name="coordinador" placeholder="Ej: No / Sí, María Pérez">
          </div>

          <div class="full">
            <label>Notas adicionales (Opcional)</label>
            <textarea name="notas" placeholder="Información extra que desee añadir"></textarea>
          </div>
        </div>

        <button type="submit" id="btn">Submit</button>
        <div class="msg" id="msg"></div>

        <div class="legal">
          This form is protected by reCAPTCHA and the Google Privacy Policy and Terms of Service apply.
        </div>
      </form>
    </div>
  </div>

  <script>
    const form = document.getElementById("form");
    const btn = document.getElementById("btn");
    const msg = document.getElementById("msg");

    function formatDate(v){
      if(!v) return "n/a";
      // v viene como YYYY-MM-DD
      const [y,m,d] = v.split("-");
      if(!y || !m || !d) return v;
      return `${m}/${d}/${y}`;
    }

    function formatTime(v){
      if(!v) return "n/a";
      // v viene como HH:MM (24h)
      const [hh,mm] = v.split(":");
      if(hh == null || mm == null) return v;
      let H = parseInt(hh,10);
      if (Number.isNaN(H)) return v;
      const ampm = H >= 12 ? "pm" : "am";
      H = H % 12; if (H === 0) H = 12;
      return `${H}:${mm} ${ampm}`;
    }

    function line(label, value){
      const v = (value ?? "").toString().trim();
      return `${label}: ${v ? v : "n/a"}`;
    }

    function buildDetails(data){
      // OJO: aquí es donde evitamos que todo llegue “aplastado”
      // Enviamos en líneas separadas y en orden
      const lines = [
        line("Actividad", data.actividad),
        line("Ciudad del Evento", data.ciudad),
        line("Día del Evento", formatDate(data.dia)),
        line("Hora del Evento", formatTime(data.hora)),
        line("Coordinador de Eventos", data.coordinador),
      ];

      // Notas al final (si existen)
      const notas = (data.notas ?? "").toString().trim();
      if(notas) lines.push(`Notas: ${notas}`);

      return lines.join("\n");
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      btn.disabled = true;
      btn.textContent = "Enviando…";
      msg.textContent = "";

      const data = Object.fromEntries(new FormData(form).entries());

      try {
        const token = await grecaptcha.execute(SITE_KEY, { action: "submit_form" });

        const res = await fetch(BACKEND_URL + "/api/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: data.name,
            email: data.email,
            phone: data.phone,
            service: data.service,
            // Aquí va el “Detalles” limpio, no apilado
            details: buildDetails(data),
            recaptchaToken: token
          })
        });

        const out = await res.json();
        if (!res.ok) throw new Error(out.error || "Error");

        msg.innerHTML = `<span class="ok">Formulario enviado correctamente ✅</span>`;
        form.reset();
      } catch (err) {
        msg.innerHTML = `<span class="err">Error al enviar. Intente nuevamente.</span>`;
      } finally {
        btn.disabled = false;
        btn.textContent = "Submit";
      }
    });
  </script>
</body>
</html>
