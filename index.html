<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Puerto Rico Dresses — Formulario</title>

  <style>
    :root{
      --bg:#f3f4f6;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --btn:#1f6f8b;
      --btn2:#17556a;
      --radius:14px;
    }

    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:var(--text);
    }

    .wrap{
      max-width:520px;
      margin:18px auto;
      padding:14px;
    }

    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:18px 18px 16px;
      box-shadow:0 10px 28px rgba(0,0,0,.10);
      border:1px solid rgba(17,24,39,.06);
    }

    .brand{
      text-align:center;
      margin:4px 0 12px;
    }

    .brand .logo{
      font-weight:900;
      font-size:22px;
      letter-spacing:.3px;
      margin:0;
    }
    .brand .sub{
      margin:6px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
    }

    .divider{
      height:1px;
      background:var(--line);
      margin:14px 0 8px;
    }

    label{
      display:block;
      margin-top:14px;
      font-weight:700;
      font-size:13px;
      color:#1f2937;
    }

    input, select, textarea{
      width:100%;
      margin-top:7px;
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      font-size:14px;
      outline:none;
      background:#fff;
      box-sizing:border-box;
    }

    textarea{ min-height:110px; resize:vertical; }

    .hint{
      margin-top:10px;
      padding:12px 12px;
      border:1px dashed #d1d5db;
      border-radius:12px;
      background:#fafafa;
      color:#4b5563;
      font-size:12.8px;
      line-height:1.35;
    }

    .optional{
      font-weight:600;
      color:#9ca3af;
      font-size:11px;
      margin-left:6px;
    }

    button{
      margin-top:16px;
      width:100%;
      padding:12px 14px;
      background:linear-gradient(180deg,var(--btn),var(--btn2));
      color:#fff;
      border:none;
      border-radius:12px;
      font-weight:900;
      cursor:pointer;
      letter-spacing:.2px;
    }
    button:disabled{opacity:.65; cursor:not-allowed;}

    .msg{ margin-top:10px; font-size:13px; }
    .ok{ color:#0a7b34; font-weight:900; }
    .err{ color:#b42318; font-weight:900; }

    .note{
      margin-top:14px;
      color:#374151;
      font-size:12.8px;
      line-height:1.35;
    }
    .note b{font-weight:900;}

    .legal{
      margin-top:12px;
      font-size:11.5px;
      color:#6b7280;
      line-height:1.35;
    }
  </style>

  <!-- CONFIG (NO TOCAR si ya funciona) -->
  <script>
    const SITE_KEY = "6LdB4jAsAAAAALaPzH7IBial1E3b5I4PG77-P15n";
    const BACKEND_URL = "https://secure-form-email-backend.onrender.com";
  </script>

  <!-- Google reCAPTCHA v3 -->
  <script src="https://www.google.com/recaptcha/api.js?render=6LdB4jAsAAAAALaPzH7IBial1E3b5I4PG77-P15n"></script>
</head>

<body>
  <div class="wrap">
    <div class="card">

      <div class="brand">
        <h1 class="logo">Puerto Rico Dresses</h1>
        <p class="sub">Formulario de solicitud. Complete los encasillados para recibir una respuesta por email.</p>
      </div>

      <div class="divider"></div>

      <form id="form" autocomplete="on">
        <label for="name">Name</label>
        <input id="name" name="name" required />

        <label for="email">Email Address</label>
        <input id="email" name="email" type="email" required />

        <label for="phone">Phone Number</label>
        <input id="phone" name="phone" required />

        <label for="service">Servicio que usted desea</label>
        <select id="service" name="service" required>
          <option value="">— Select —</option>
          <option value="Bodas/Quinceañeros">Bodas/Quinceañeros</option>
          <option value="Underwater Photography">Underwater Photography</option>
          <option value="Sesión de Parejas y Modelos">Sesión de Parejas y Modelos</option>
          <option value="Otro">Otro</option>
        </select>

        <!-- IMPORTANTE: esto SOLO es texto visible, NO se envía por email -->
        <div class="hint">
          Escriba en el encasillado de abajo cualquiera de las siguientes:<br><br>
          Para Bodas/Quinceañeros mencione donde sera la recepción.<br>
          Para Underwater Photography escriba Piscina o Manantial.<br>
          Para sesión de Parejas y Modelos mencione lugar deseado.<br>
          De no tener alguno escriba n/a.
        </div>

        <label for="actividad">¿Dónde será su actividad?<span class="optional">(OPCIONAL)</span></label>
        <textarea id="actividad" name="actividad"></textarea>

        <label for="ciudad">Ciudad del Evento<span class="optional">(OPCIONAL)</span></label>
        <input id="ciudad" name="ciudad" />

        <label for="dia">Día de su evento<span class="optional">(OPCIONAL)</span></label>
        <input id="dia" name="dia" type="date" />

        <label for="hora">Hora del Evento<span class="optional">(OPCIONAL)</span></label>
        <input id="hora" name="hora" type="time" />

        <label for="coordinador">¿Tienes Coordinador de eventos? ¿Cuál es su nombre?<span class="optional">(OPCIONAL)</span></label>
        <input id="coordinador" name="coordinador" />

        <div class="note">
          <b>Nota*</b><br>
          Fecha sujetas a disponibilidad.<br>
          Usted recibirá un correo electrónico con su cotización inmediatamente presione <b>SUBMIT</b>.
        </div>

        <button type="submit" id="btn">Submit</button>
        <div class="msg" id="msg"></div>

        <div class="legal">
          This form is protected by reCAPTCHA and the Google Privacy Policy and Terms of Service apply.
        </div>
      </form>

    </div>
  </div>

  <script>
    const form = document.getElementById("form");
    const btn = document.getElementById("btn");
    const msg = document.getElementById("msg");

    function formatDate(val){
      if(!val) return "n/a";
      try{
        const [y,m,d] = val.split("-");
        if(!y || !m || !d) return val;
        return `${m}/${d}/${y}`;
      }catch(_){ return val; }
    }

    function formatTime(val){
      if(!val) return "n/a";
      try{
        const [hh,mm] = val.split(":");
        if(hh === undefined || mm === undefined) return val;
        let h = parseInt(hh,10);
        const ampm = h >= 12 ? "pm" : "am";
        h = h % 12; if(h === 0) h = 12;
        return `${h}:${mm} ${ampm}`;
      }catch(_){ return val; }
    }

    // ✅ SOLO encasillados: nada del texto de instrucciones se manda por email
    function buildDetails(data){
      const lines = [];
      lines.push(`¿Dónde será su actividad?: ${data.actividad?.trim() ? data.actividad.trim() : "n/a"}`);
      lines.push(`Ciudad del Evento: ${data.ciudad?.trim() ? data.ciudad.trim() : "n/a"}`);
      lines.push(`Día de su evento: ${formatDate(data.dia)}`);
      lines.push(`Hora del Evento: ${formatTime(data.hora)}`);
      lines.push(`Coordinador: ${data.coordinador?.trim() ? data.coordinador.trim() : "n/a"}`);
      return lines.join("\n");
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      btn.disabled = true;
      btn.textContent = "Enviando…";
      msg.textContent = "";

      const data = Object.fromEntries(new FormData(form).entries());

      try {
        const token = await grecaptcha.execute(SITE_KEY, { action: "submit_form" });

        const res = await fetch(BACKEND_URL + "/api/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: data.name,
            email: data.email,
            phone: data.phone,
            service: data.service,
            details: buildDetails(data),
            recaptchaToken: token
          })
        });

        const out = await res.json().catch(() => ({}));
        if (!res.ok) throw new Error(out.error || "Server error");

        msg.innerHTML = `<span class="ok">Formulario enviado correctamente ✅</span>`;
        form.reset();
      } catch (err) {
        msg.innerHTML = `<span class="err">Error al enviar. Intente nuevamente.</span>`;
      } finally {
        btn.disabled = false;
        btn.textContent = "Submit";
      }
    });
  </script>
</body>
</html>
