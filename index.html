<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cuestionario de Servicio</title>

  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:#f6f7fb;
      color:#111827;
    }
    .wrap{max-width:560px;margin:28px auto;padding:16px}
    .card{
      background:#fff;
      border-radius:12px;
      padding:20px;
      box-shadow:0 10px 28px rgba(0,0,0,.08);
    }
    h1{margin:0 0 6px;font-size:18px}
    p{margin:0 0 14px;font-size:13px;color:#6b7280}
    label{display:block;margin-top:14px;font-weight:700;font-size:13px}
    input,select,textarea{
      width:100%;
      margin-top:6px;
      padding:10px 12px;
      border:1px solid #d1d5db;
      border-radius:10px;
      font-size:14px;
    }
    textarea{min-height:100px;resize:vertical}
    button{
      margin-top:16px;
      width:100%;
      padding:12px;
      background:#2563eb;
      color:#fff;
      border:none;
      border-radius:10px;
      font-weight:800;
      cursor:pointer;
    }
    button:disabled{opacity:.6}
    .msg{margin-top:10px;font-size:13px}
    .ok{color:#0a7b34;font-weight:800}
    .err{color:#b42318;font-weight:800}
    .legal{margin-top:14px;font-size:11.5px;color:#6b7280}
  </style>

  <!-- CONFIG -->
  <script>
    const SITE_KEY = "6LdB4jAsAAAAALaPzH7IBial1E3b5I4PG77-P15n";
    const BACKEND_URL = "https://secure-form-email-backend.onrender.com";
  </script>

  <!-- Google reCAPTCHA v3 -->
  <script src="https://www.google.com/recaptcha/api.js?render=6LdB4jAsAAAAALaPzH7IBial1E3b5I4PG77-P15n"></script>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>Cuestionario de Servicio</h1>
      <p>Complete el formulario. Al enviarlo, recibiremos su solicitud por email.</p>

      <form id="form">
        <label>Nombre *</label>
        <input name="name" required>

        <label>Email *</label>
        <input name="email" type="email" required>

        <label>Teléfono *</label>
        <input name="phone" required>

        <label>¿Qué tipo de servicios desea? *</label>
        <input name="service" required placeholder="Ej: instalación mini split 12k, mantenimiento, diagnóstico, cotización...">

        <label>Detalles / Dirección / Notas</label>
        <textarea name="details"></textarea>

        <button type="submit" id="btn">Submit</button>
        <div class="msg" id="msg"></div>

        <div class="legal">
          This form is protected by reCAPTCHA and the Google Privacy Policy and Terms of Service apply.
        </div>
      </form>
    </div>
  </div>

  <script>
    const form = document.getElementById("form");
    const btn = document.getElementById("btn");
    const msg = document.getElementById("msg");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      btn.disabled = true;
      btn.textContent = "Enviando…";
      msg.textContent = "";

      const data = Object.fromEntries(new FormData(form).entries());

      try {
        const token = await grecaptcha.execute(SITE_KEY, { action: "submit_form" });

        const res = await fetch(BACKEND_URL + "/api/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: data.name,
            email: data.email,
            phone: data.phone,
            service: data.service,
            details: data.details,
            recaptchaToken: token
          })
        });

        const out = await res.json();
        if (!res.ok) throw new Error(out.error);

        msg.innerHTML = `<span class="ok">Formulario enviado correctamente ✅</span>`;
        form.reset();
      } catch (err) {
        msg.innerHTML = `<span class="err">Error al enviar. Intente nuevamente.</span>`;
      } finally {
        btn.disabled = false;
        btn.textContent = "Submit";
      }
    });
  </script>
</body>
</html>
